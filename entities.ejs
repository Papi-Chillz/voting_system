<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Entities</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen font-sans p-6"
      style="background-image: url('/components/images/vote7.jpg'); 
             background-size: cover; 
             background-position: center; 
             background-repeat: no-repeat;">
             
  <div class="max-w-7xl mx-auto bg-white shadow-lg rounded p-8">
    <h1 class="text-3xl font-bold mb-8 text-center text-blue-700">All Entities Data</h1>

    <% if (!entitiesData || Object.keys(entitiesData).length === 0) { %>
      <p class="text-center text-gray-600">No entity data found.</p>
    <% } else { %>
      <% Object.keys(entitiesData).forEach(function(entityName) { 
           const rows = entitiesData[entityName]; %>

        <section class="mb-12">
          <h2 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2"><%= entityName.replace(/_/g,' ').toUpperCase() %></h2>

          <!-- Add row form -->
          <form method="POST" action="/entities/add/<%= entityName %>" class="flex flex-wrap gap-2 mb-6">
            <% if(rows.length > 0) { %>
              <% Object.keys(rows[0]).forEach(col => { %>
                <% if(!col.endsWith('_id')) { %>
                  <input type="text" name="<%= col %>" placeholder="<%= col.replace(/_/g,' ').toUpperCase() %>" class="border px-2 py-1 rounded w-32" />
                <% } else if(foreignKeyMaps[col]) { %>
                  <select name="<%= col %>" class="border px-2 py-1 rounded w-32">
                    <% Object.entries(foreignKeyMaps[col]).forEach(([id, name]) => { %>
                      <option value="<%= id %>"><%= name %></option>
                    <% }) %>
                  </select>
                <% } %>
              <% }) %>
              <button type="submit" class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700">Add</button>
            <% } %>
          </form>

          <!-- Table -->
          <% if(rows.length === 0) { %>
            <p class="text-gray-500">No data available.</p>
          <% } else { %>
            <div class="overflow-x-auto">
              <table class="min-w-full border border-gray-300">
                <thead class="bg-gray-200">
                  <tr class="text-left text-gray-700">
                    <% Object.keys(rows[0]).forEach(col => { %>
                      <th class="border px-4 py-2"><%= col.replace(/_/g,' ').toUpperCase() %></th>
                    <% }) %>
                    <th class="border px-4 py-2">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% rows.forEach(row => { %>
                    <tr class="hover:bg-gray-100">
                      <% Object.entries(row).forEach(([key,val]) => { %>
                        <td class="border px-4 py-2"><%= val %></td>
                      <% }) %>
                      <td class="border px-4 py-2">
                        <form method="POST" action="/entities/delete/<%= entityName %>/<%= row.id %>" onsubmit="return confirm('Are you sure?');">
                          <button type="submit" class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700">Delete</button>
                        </form>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          <% } %>

        </section>
      <% }) %>
    <% } %>

    <div class="text-center mt-6">
      <a href="/" class="inline-block px-6 py-3 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700 transition">
        Back to Home
      </a>
    </div>
  </div>
</body>
</html>
